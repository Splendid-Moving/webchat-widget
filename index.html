<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Local ChatKit Test</title>

    <!-- ChatKit script -->
    <script
      src="https://cdn.platform.openai.com/deployments/chatkit/chatkit.js"
    ></script>

    <style>
      body {
        background: #020617;
        color: #e5e7eb;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        padding: 32px;
      }
      h2 {
        margin-bottom: 16px;
      }
      #chat-box {
        width: 420px;
        height: 640px;
        border-radius: 16px;
        overflow: hidden;
        border: 1px solid #1f2937;
        background: #020617;
      }
      openai-chatkit {
        display: block;
        width: 100%;
        height: 100%;
      }
    </style>
  </head>

  <body>
    <h2>Local ChatKit Test</h2>

    <div id="chat-box">
      <openai-chatkit id="chat"></openai-chatkit>
    </div>

    <script>
      async function initChat() {
        try {
          // 1) ask our local backend for a session
          const res = await fetch("/session", { method: "POST" });
          const data = await res.json();
          console.log("Session response:", data);

          if (!data.client_secret) {
            throw new Error("No client_secret in /session response");
          }

          // 2) configure the ChatKit element
          const el = document.getElementById("chat");

          el.setOptions({
            api: {
              async getClientSecret(existing) {
                // we keep it dumb for now: always use the one we just got
                return data.client_secret;
              },
            },
            theme: {
              colorScheme: "dark",
            },
            startScreen: {
              greeting: "Hey, I'm your test agent. Ask me something.",
            },
          });
        } catch (e) {
          console.error("initChat error:", e);
        }
      }

      // Run after page+script load
      window.addEventListener("load", initChat);
    </script>
  </body>
</html>